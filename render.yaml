# ============================================================
# SkillForge AI - Render.com Blueprint
# Complete deployment configuration with CI Intelligence
# ============================================================

services:
  # ============================================================
  # Main Integration Service
  # ============================================================
  - type: web
    name: skillforge-integration
    runtime: node
    region: ohio
    plan: starter
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: SUPABASE_URL
        fromDatabase:
          name: skillforge-db
          property: connectionString
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: GITHUB_TOKEN
        sync: false
      - key: CLAWDBOT_API_TOKEN
        sync: false
    healthCheckPath: /api/health
    autoDeploy: true

  # ============================================================
  # Skills API Service
  # ============================================================
  - type: web
    name: skillforge-skills-api
    runtime: node
    region: ohio
    plan: starter
    buildCommand: npm install && npm run build
    startCommand: node dist/api/server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: CLAWDBOT_API_TOKEN
        sync: false
    healthCheckPath: /api/health
    autoDeploy: true

  # ============================================================
  # CI Intelligence API Service
  # ============================================================
  - type: web
    name: skillforge-ci-api
    runtime: node
    region: ohio
    plan: starter
    buildCommand: npm install && npm run build
    startCommand: node dist/ci-intelligence/api-server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: CI_API_PORT
        value: 3002
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: NVIDIA_NIM_API_KEY
        sync: false
      - key: SIMILARWEB_API_KEY
        sync: false
    healthCheckPath: /ci/health
    autoDeploy: true

  # ============================================================
  # Background Sync Worker
  # ============================================================
  - type: worker
    name: skillforge-sync-worker
    runtime: node
    region: ohio
    plan: starter
    buildCommand: npm install && npm run build
    startCommand: node dist/workers/sync-worker.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: SYNC_INTERVAL_HOURS
        value: "24"
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: GITHUB_TOKEN
        sync: false
      - key: CLAWDBOT_API_TOKEN
        sync: false
    autoDeploy: true

# ============================================================
# Environment Groups
# ============================================================
envVarGroups:
  - name: skillforge-secrets
    envVars:
      - key: SUPABASE_URL
        value: https://mocerqjnksmhcjzxrewo.supabase.co
      - key: SUPABASE_SERVICE_ROLE_KEY
        generateValue: true
      - key: NVIDIA_NIM_API_KEY
        generateValue: true
      - key: SIMILARWEB_API_KEY
        generateValue: true
      - key: GITHUB_TOKEN
        generateValue: true
      - key: CLAWDBOT_API_TOKEN
        generateValue: true
